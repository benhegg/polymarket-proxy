<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polymarket Tracker - Live Data</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900">
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [markets, setMarkets] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [sortBy, setSortBy] = useState('volume');
      const [filterCategory, setFilterCategory] = useState('All');
      const [lastUpdate, setLastUpdate] = useState(null);

      const API_URL = '/api/markets';

      const fetchMarkets = async () => {
        setLoading(true);
        setError(null);
        try {
          const response = await fetch(API_URL);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          
          const data = await response.json();
          
          const parsed = data.map(m => {
            try {
              const prices = JSON.parse(m.outcomePrices || '["0.5","0.5"]');
              return {
                id: m.id,
                question: m.question,
                category: m.category || 'Other',
                volume: parseFloat(m.volume || 0),
                liquidity: parseFloat(m.liquidity || 0),
                price: parseFloat(prices[0] || 0.5),
                slug: m.slug
              };
            } catch (e) {
              return null;
            }
          }).filter(m => m && m.volume > 0);

          setMarkets(parsed);
          setLastUpdate(new Date().toLocaleTimeString());
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      useEffect(() => {
        fetchMarkets();
      }, []);

      const categories = ['All', ...new Set(markets.map(m => m.category))];

      const getBetRec = (market) => {
        const vol = market.volume;
        let betSize, confidence;
        
        if (vol > 20000000) {
          betSize = '$75-100';
          confidence = 'HIGH';
        } else if (vol > 10000000) {
          betSize = '$40-60';
          confidence = 'MEDIUM';
        } else if (vol > 5000000) {
          betSize = '$20-40';
          confidence = 'MEDIUM';
        } else {
          betSize = '$10-20';
          confidence = 'LOW';
        }

        const potentialReturn = ((1 / market.price - 1) * 100).toFixed(0);
        const impliedProb = (market.price * 100).toFixed(0);

        return { betSize, confidence, potentialReturn, impliedProb };
      };

      const displayMarkets = markets
        .filter(m => filterCategory === 'All' || m.category === filterCategory)
        .sort((a, b) => {
          if (sortBy === 'volume') return b.volume - a.volume;
          if (sortBy === 'price') return b.price - a.price;
          return 0;
        })
        .slice(0, 20);

      if (loading && markets.length === 0) {
        return (
          <div className="min-h-screen bg-gray-900 flex items-center justify-center">
            <div className="text-white text-2xl">Loading markets...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-900 p-6">
          <div className="max-w-7xl mx-auto">
            
            {/* Header */}
            <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg p-6 mb-6">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-4xl font-bold text-white">ðŸš€ Polymarket Live Tracker</h1>
                  <p className="text-blue-100 mt-2">
                    Real-time data â€¢ {markets.length} active markets
                  </p>
                </div>
                <div className="text-right">
                  <button
                    onClick={fetchMarkets}
                    disabled={loading}
                    className="px-6 py-3 bg-white text-blue-600 rounded-lg font-bold hover:bg-blue-50 disabled:opacity-50"
                  >
                    {loading ? 'Loading...' : 'Refresh'}
                  </button>
                  {lastUpdate && (
                    <div className="text-sm text-blue-100 mt-2">
                      Updated: {lastUpdate}
                    </div>
                  )}
                </div>
              </div>
            </div>

            {/* Error */}
            {error && (
              <div className="bg-red-900 border border-red-700 rounded-lg p-4 mb-6 text-red-100">
                Error: {error}
              </div>
            )}

            {/* Stats */}
            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <div className="text-gray-400 text-sm">Total Markets</div>
                <div className="text-3xl font-bold text-white">{markets.length}</div>
              </div>
              <div className="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <div className="text-gray-400 text-sm">HIGH Confidence</div>
                <div className="text-3xl font-bold text-green-400">
                  {markets.filter(m => getBetRec(m).confidence === 'HIGH').length}
                </div>
              </div>
              <div className="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <div className="text-gray-400 text-sm">Avg Return</div>
                <div className="text-3xl font-bold text-purple-400">
                  {markets.length > 0 
                    ? (markets.reduce((sum, m) => sum + ((1/m.price - 1) * 100), 0) / markets.length).toFixed(0) 
                    : 0}%
                </div>
              </div>
            </div>

            {/* Filters */}
            <div className="bg-gray-800 rounded-lg p-4 mb-6 border border-gray-700">
              <div className="flex gap-6 flex-wrap">
                <div>
                  <label className="text-sm font-medium text-gray-300 block mb-2">Category</label>
                  <div className="flex gap-2 flex-wrap">
                    {categories.map(cat => (
                      <button
                        key={cat}
                        onClick={() => setFilterCategory(cat)}
                        className={`px-4 py-2 rounded-lg font-medium ${
                          filterCategory === cat
                            ? 'bg-blue-600 text-white'
                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                        }`}
                      >
                        {cat}
                      </button>
                    ))}
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium text-gray-300 block mb-2">Sort By</label>
                  <select
                    value={sortBy}
                    onChange={(e) => setSortBy(e.target.value)}
                    className="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"
                  >
                    <option value="volume">Volume</option>
                    <option value="price">Price</option>
                  </select>
                </div>
              </div>
            </div>

            {/* Markets */}
            <div className="space-y-4">
              {displayMarkets.map(market => {
                const rec = getBetRec(market);
                
                return (
                  <div key={market.id} className="bg-gray-800 rounded-lg p-6 border border-gray-700 hover:border-blue-500 transition">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex-1">
                        <h2 className="text-xl font-bold text-white mb-2">{market.question}</h2>
                        <span className="px-3 py-1 bg-blue-900 text-blue-200 rounded-full text-sm font-medium">
                          {market.category}
                        </span>
                      </div>
                      <div className={`px-4 py-2 rounded-lg font-bold ${
                        rec.confidence === 'HIGH' ? 'bg-green-600 text-white' :
                        rec.confidence === 'MEDIUM' ? 'bg-yellow-600 text-white' :
                        'bg-orange-600 text-white'
                      }`}>
                        {rec.confidence}
                      </div>
                    </div>

                    <div className="grid grid-cols-4 gap-6 mb-4">
                      <div>
                        <div className="text-sm text-gray-400">YES Price</div>
                        <div className="text-2xl font-bold text-white">
                          {(market.price * 100).toFixed(0)}Â¢
                        </div>
                        <div className="text-xs text-gray-500">{rec.impliedProb}% prob</div>
                      </div>

                      <div>
                        <div className="text-sm text-gray-400">Volume</div>
                        <div className="text-2xl font-bold text-white">
                          ${(market.volume / 1000000).toFixed(1)}M
                        </div>
                      </div>

                      <div>
                        <div className="text-sm text-gray-400">Return</div>
                        <div className="text-2xl font-bold text-green-400">
                          +{rec.potentialReturn}%
                        </div>
                      </div>

                      <div>
                        <div className="text-sm text-gray-400">Bet Size</div>
                        <div className="text-2xl font-bold text-purple-400">
                          {rec.betSize}
                        </div>
                      </div>
                    </div>

                    <div className="border-t border-gray-700 pt-4">
                      <div className="flex items-center justify-between">
                        <div className="text-sm text-gray-300">
                          Buy YES at {(market.price * 100).toFixed(0)}Â¢
                        </div>
                        
                          href={`https://polymarket.com/event/${market.slug || ''}`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg"
                        >
                          Place Bet â†’
                        </a>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>

            {/* Footer */}
            <div className="mt-6 bg-green-900 border border-green-700 rounded-lg p-4">
              <p className="font-bold text-white mb-2">âœ… Connected to Live Polymarket API</p>
              <ul className="text-sm text-green-100 space-y-1">
                <li>â€¢ HIGH: Volume over $20M (smart money)</li>
                <li>â€¢ MEDIUM: Volume $5-20M (good signals)</li>
                <li>â€¢ LOW: Volume under $5M (speculative)</li>
                <li>â€¢ Click Refresh to update prices</li>
              </ul>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
